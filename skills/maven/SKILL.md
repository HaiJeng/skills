---
name: maven
description: Build automation and dependency management for Java projects using Apache Maven. Use when working with Maven projects (pom.xml), managing dependencies, running builds, or handling Maven lifecycle phases.
triggers:
- maven
- pom.xml
- mvn
- "maven build"
- "maven dependency"
---

# Maven Development Guide

## Maven Project Structure

Standard Maven project layout:

```
my-project/
├── pom.xml                    # Project Object Model (Maven configuration)
├── src/
│   ├── main/
│   │   ├── java/              # Production Java source code
│   │   └── resources/         # Production resources (properties, config files)
│   └── test/
│       ├── java/              # Test Java source code
│       └── resources/         # Test resources
└── target/                    # Build output (generated by Maven)
```

## Essential Maven Commands

### Build Commands

```bash
# Clean previous builds
mvn clean

# Compile source code
mvn compile

# Run all tests
mvn test

# Package into JAR/WAR
mvn package

# Install to local repository
mvn install

# Deploy to remote repository
mvn deploy

# Clean and package (common combination)
mvn clean package

# Skip tests during build
mvn package -DskipTests

# Run a specific test class
mvn test -Dtest=MyTestClass

# Run a specific test method
mvn test -Dtest=MyTestClass#testMethod
```

### Dependency Management Commands

```bash
# Display dependency tree
mvn dependency:tree

# Analyze dependencies (find unused or conflicting dependencies)
mvn dependency:analyze

# List all dependencies
mvn dependency:list

# Copy dependencies to target directory
mvn dependency:copy-dependencies

# Resolve dependency conflicts
mvn dependency:resolve
```

### Project Information Commands

```bash
# Show effective POM (merged from parent and profiles)
mvn help:effective-pom

# Show plugin configuration
mvn help:describe -Dplugin=compiler

# List all active profiles
mvn help:active-profiles
```

## Understanding pom.xml

### Basic POM Structure

```xml
<project xmlns="http://maven.apache.org/POM/4.0.0"
         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 
         http://maven.apache.org/xsd/maven-4.0.0.xsd">
    <modelVersion>4.0.0</modelVersion>

    <!-- Project coordinates -->
    <groupId>com.example</groupId>
    <artifactId>my-app</artifactId>
    <version>1.0-SNAPSHOT</version>
    <packaging>jar</packaging>

    <!-- Properties for version management -->
    <properties>
        <project.build.sourceEncoding>UTF-8</project.build.sourceEncoding>
        <maven.compiler.source>11</maven.compiler.source>
        <maven.compiler.target>11</maven.compiler.target>
        <junit.version>5.9.2</junit.version>
    </properties>

    <!-- Dependencies -->
    <dependencies>
        <dependency>
            <groupId>org.junit.jupiter</groupId>
            <artifactId>junit-jupiter</artifactId>
            <version>${junit.version}</version>
            <scope>test</scope>
        </dependency>
    </dependencies>

    <!-- Build configuration -->
    <build>
        <plugins>
            <plugin>
                <groupId>org.apache.maven.plugins</groupId>
                <artifactId>maven-compiler-plugin</artifactId>
                <version>3.11.0</version>
                <configuration>
                    <source>11</source>
                    <target>11</target>
                </configuration>
            </plugin>
        </plugins>
    </build>
</project>
```

### Dependency Scopes

- **compile**: Default scope, available in all classpaths
- **provided**: Expected to be provided by JDK or container at runtime
- **runtime**: Not needed for compilation but needed at runtime
- **test**: Only available for test compilation and execution
- **system**: Similar to provided but must include explicit JAR path
- **import**: Only used in dependencyManagement section to import POM dependencies

## Maven Lifecycle Phases

Maven has three built-in lifecycles:

### Clean Lifecycle
- `pre-clean`
- `clean` (removes target directory)
- `post-clean`

### Default (Build) Lifecycle
- `validate` - validates the project is correct
- `compile` - compiles source code
- `test` - runs unit tests
- `package` - packages into JAR/WAR
- `verify` - runs integration tests
- `install` - installs to local repository
- `deploy` - deploys to remote repository

### Site Lifecycle
- `pre-site`
- `site` - generates project site documentation
- `post-site`
- `site-deploy`

## Best Practices

1. **Use Dependency Management**: Centralize dependency versions in `<dependencyManagement>` section in parent POM
2. **Define Properties**: Use `<properties>` for version numbers to ensure consistency
3. **Specify Plugin Versions**: Always declare plugin versions to avoid using old defaults
4. **Use Profiles**: Create profiles for environment-specific configurations (dev, test, prod)
5. **Optimize Build**: Use `-T` flag for parallel builds: `mvn clean install -T 4`
6. **Offline Mode**: Use `-o` flag for offline builds when dependencies are already cached
7. **Batch Mode**: Use `-B` flag for non-interactive builds (useful in CI/CD)

## Common Issues and Solutions

### Issue: "Could not resolve dependencies"
```bash
# Force update snapshots/releases
mvn clean install -U

# Clean local repository cache
rm -rf ~/.m2/repository
mvn clean install
```

### Issue: Build is slow
```bash
# Use parallel builds
mvn clean install -T 1C  # Uses 1 thread per CPU core

# Skip tests during development
mvn package -DskipTests

# Use incremental compilation (maven-compiler-plugin 3.1+)
# Already enabled by default
```

### Issue: Out of memory during build
```bash
# Increase Maven memory
export MAVEN_OPTS="-Xmx1024m -Xms512m"
mvn clean install
```

## Integration with IDEs

Maven integrates seamlessly with major IDEs:
- **IntelliJ IDEA**: Auto-imports pom.xml changes
- **Eclipse**: Run `mvn eclipse:eclipse` to generate project files
- **VS Code**: Use "Java Extension Pack" with Maven support

## Useful Maven Plugins

```xml
<!-- Maven Compiler Plugin -->
<plugin>
    <groupId>org.apache.maven.plugins</groupId>
    <artifactId>maven-compiler-plugin</artifactId>
    <version>3.11.0</version>
</plugin>

<!-- Maven Surefire Plugin (Unit Tests) -->
<plugin>
    <groupId>org.apache.maven.plugins</groupId>
    <artifactId>maven-surefire-plugin</artifactId>
    <version>3.0.0</version>
</plugin>

<!-- Maven Failsafe Plugin (Integration Tests) -->
<plugin>
    <groupId>org.apache.maven.plugins</groupId>
    <artifactId>maven-failsafe-plugin</artifactId>
    <version>3.0.0</version>
</plugin>

<!-- Maven Checkstyle Plugin -->
<plugin>
    <groupId>org.apache.maven.plugins</groupId>
    <artifactId>maven-checkstyle-plugin</artifactId>
    <version>3.2.0</version>
</plugin>
```
